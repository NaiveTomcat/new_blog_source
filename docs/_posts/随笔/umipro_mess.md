---
title: 机械革命Umi Pro 3的Arch Linux初探
date: 2021-07-30 14:00:00
tags: 
  - 开发
  - 系统
  - 笔记本
sidebar: auto
categories: 
  - 开发
permalink: /pages/0214cf/
---

## 前言

突然发现已经有一个月没更博客了 ~~（虽然说这大概是正常频率）~~ ，最近把Windows升到了最新的内部预览版本`22000.100`，有了`wslg`的支持（虽然看起来`wslg`默认用户`uid`是`1000`，导致`dbus`出了亿点点问题，好多程序跑不起来……），据说也支持挂载硬盘进去了。我就想这对于双系统十分利好，主要在文件共享方面。同时D盘也快满了，于是就将D盘挪到一整块1t的固态上去，腾出来的地方装了一个Arch Linux，没想到遇到了非常多的问题……

## 安装

既然说到安装`Linux`之后的问题，那首先就要说说安装的时候遇到的问题了:thinking:。装的时候没有用`archinstall`，照着`archwiki`上的步骤一步一步装就行了（这次我记住在Live CD里安网络管理包了:rofl:，上次装arch的时候又重新进Live CD专门为解决无线的问题），装完基本包之后重启进tty，内存CPU硬盘都能认出来，`GRUB`也没出锅，开始配置图形界面。

桌面环境我选择了`KDE Plasma`这一套，主要还是出于个人习惯：曾经在`Gnome`和`KDE Plasma`中间左右横跳，最后还是觉得`KDE Plasma`用起来更舒服（除了`dolphin`），于是这次就直接装`plasma`软件包组了。装完之后，按照惯例，自然就装上`sddm`作为显示管理器了。然后，创建一般用户，设置`sudoer`文件，命令行输入`sddm`，然后就翻车了……`sddm`正常启动，然后输入密码登录之后就黑屏卡住了……不知道什么原因，`systemctl enable sddm.service --now`就*看似*解决了这个问题。

进桌面环境之后，照例配主题配UI之类的不提，然后就是<ruby>喜闻乐见<rt><rp>（</rp>非常离谱<rp>）</rp></rt></ruby>的安驱动（Nvidia驱动）环节。安好`nvidia`、`cuda`、`cudnn`之后，运行`nvidia-xconfig`命令，重启之后**甚至sddm都出不来……**无奈只能切到新的tty上恢复`/etc/X11/xorg.conf`到之前的状态。笔记本的可见光摄像头和红外摄像头居然都不需要驱动，用vlc找到设备路径 ~~并欣赏了IR摄像头拍出的奇妙画面~~ 之后，从AUR上安装`howdy`并配置好pam，就可以使用人脸识别登录、解锁和授权`sudo`了。打开系统监视器，粗略看看CPU频率，基本都在4GHz以上，安装过程（大概）就结束了。

## 暗坑

还记得上面说的“打开系统监视器，粗略看看CPU频率，基本都在4GHz以上”吗？第一个暗坑（也是我还没爬出来的一个）就在这里。后面的使用中发现，CPU在较重负载上只能做到全核2.4GHz的频率（不过也比标称的2.3GHz高一点就是了:rofl:）。根据散热风扇噪声大小，我判断风扇并没有全速运转（多线程编译内核的时候声音甚至比在Windows下面日常插电使用的声音还小），于是就怀疑风扇控制的问题（这是第二个暗坑，同样的，我还没爬出来:upside_down_face:）。不过传感器报的封装温度和最高核心温度都只在60℃上下，我就倍感奇怪。于是我怀疑供电选择的问题，因为Windows里面从电池供电的时候笔记本的行为和这里非常接近。通过acpi相关工具，引出了第三个坑：这个本子（至少）在Linux里面的ACPI支持有大问题：Thermal Zone温度和散热风扇居然都没有出现在acpi设备里面……想要改这些东西，就只能找野办法了。

在笔记本设备上，有个东西叫做EC：Embedded Controller。
